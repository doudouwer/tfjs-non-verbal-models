{"id":"node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","dependencies":[{"name":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js.map","includedInParent":true,"mtime":1758037808385},{"name":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/package.json","includedInParent":true,"mtime":1758036617787},{"name":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/.babelrc","includedInParent":true,"mtime":1758036617787},{"name":"@tensorflow-models/face-detection","loc":{"line":56,"column":31,"index":3307},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-detection/dist/face-detection.esm.js"},{"name":"@tensorflow/tfjs-converter","loc":{"line":57,"column":21,"index":3366},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow/tfjs-converter/dist/index.js"},{"name":"@tensorflow/tfjs-core","loc":{"line":58,"column":17,"index":3414},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow/tfjs-core/dist/index.js"},{"name":"../constants","loc":{"line":59,"column":26,"index":3466},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/constants.js"},{"name":"../shared/calculators/association_norm_rect","loc":{"line":60,"column":38,"index":3521},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/association_norm_rect.js"},{"name":"../shared/calculators/calculate_landmark_projection","loc":{"line":61,"column":46,"index":3615},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/calculate_landmark_projection.js"},{"name":"../shared/calculators/convert_image_to_tensor","loc":{"line":62,"column":40,"index":3711},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/convert_image_to_tensor.js"},{"name":"../shared/calculators/detection_to_rect","loc":{"line":63,"column":34,"index":3795},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/detection_to_rect.js"},{"name":"../shared/calculators/image_utils","loc":{"line":64,"column":28,"index":3867},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/image_utils.js"},{"name":"../shared/calculators/landmarks_refinement","loc":{"line":65,"column":37,"index":3942},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/landmarks_refinement.js"},{"name":"../shared/calculators/landmarks_to_detection","loc":{"line":66,"column":39,"index":4028},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/landmarks_to_detection.js"},{"name":"../shared/calculators/normalized_keypoints_to_keypoints","loc":{"line":67,"column":50,"index":4127},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/normalized_keypoints_to_keypoints.js"},{"name":"../shared/calculators/tensors_to_landmarks","loc":{"line":68,"column":37,"index":4224},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/tensors_to_landmarks.js"},{"name":"../shared/calculators/transform_rect","loc":{"line":69,"column":31,"index":4302},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/transform_rect.js"},{"name":"./constants","loc":{"line":70,"column":24,"index":4367},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/constants.js"},{"name":"./detector_utils","loc":{"line":71,"column":31,"index":4414},"parent":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector.js","resolved":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/tfjs/detector_utils.js"}],"generated":{"js":"\"use strict\";\n/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.load = void 0;\nvar face_detection_1 = require(\"@tensorflow-models/face-detection\");\nvar tfconv = require(\"@tensorflow/tfjs-converter\");\nvar tf = require(\"@tensorflow/tfjs-core\");\nvar constants_1 = require(\"../constants\");\nvar association_norm_rect_1 = require(\"../shared/calculators/association_norm_rect\");\nvar calculate_landmark_projection_1 = require(\"../shared/calculators/calculate_landmark_projection\");\nvar convert_image_to_tensor_1 = require(\"../shared/calculators/convert_image_to_tensor\");\nvar detection_to_rect_1 = require(\"../shared/calculators/detection_to_rect\");\nvar image_utils_1 = require(\"../shared/calculators/image_utils\");\nvar landmarks_refinement_1 = require(\"../shared/calculators/landmarks_refinement\");\nvar landmarks_to_detection_1 = require(\"../shared/calculators/landmarks_to_detection\");\nvar normalized_keypoints_to_keypoints_1 = require(\"../shared/calculators/normalized_keypoints_to_keypoints\");\nvar tensors_to_landmarks_1 = require(\"../shared/calculators/tensors_to_landmarks\");\nvar transform_rect_1 = require(\"../shared/calculators/transform_rect\");\nvar constants = require(\"./constants\");\nvar detector_utils_1 = require(\"./detector_utils\");\n/**\n * MediaPipFaceMesh class.\n */\nvar MediaPipeFaceMeshTfjsLandmarksDetector = /** @class */ (function () {\n    function MediaPipeFaceMeshTfjsLandmarksDetector(detector, landmarkModel, maxFaces, withAttention) {\n        this.detector = detector;\n        this.landmarkModel = landmarkModel;\n        this.maxFaces = maxFaces;\n        this.withAttention = withAttention;\n        // Store global states.\n        this.prevFaceRectsFromLandmarks = null;\n    }\n    /**\n     * Estimates faces for an image or video frame.\n     *\n     * It returns a single face or multiple faces based on the maxFaces\n     * parameter from the `config`.\n     *\n     * @param image\n     * ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement The input\n     * image to feed through the network.\n     *\n     * @param estimationConfig Optional. See\n     *     `MediaPipeFaceMeshTfjsEstimationConfig` documentation for detail.\n     *\n     * @return An array of `Face`s.\n     */\n    // TF.js implementation of the mediapipe face landmark pipeline.\n    // ref graph:\n    // https://github.com/google/mediapipe/blob/master/mediapipe/mediapipe/modules/face_landmark/face_landmark_front_cpu.pbtxt\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.estimateFaces = function (image, estimationConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var config, imageSize, image3d, prevFaceRectsFromLandmarks, faceRectsFromDetections, allFaceDetections, faceDetections, faceRects, faceLandmarks, faces, i, landmarks, keypoints, detection;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        config = (0, detector_utils_1.validateEstimationConfig)(estimationConfig);\n                        if (image == null) {\n                            this.reset();\n                            return [2 /*return*/, []];\n                        }\n                        imageSize = (0, image_utils_1.getImageSize)(image);\n                        image3d = tf.tidy(function () {\n                            var imageTensor = tf.cast((0, image_utils_1.toImageTensor)(image), 'float32');\n                            if (config.flipHorizontal) {\n                                var batchAxis = 0;\n                                imageTensor = tf.squeeze(tf.image.flipLeftRight(\n                                // tslint:disable-next-line: no-unnecessary-type-assertion\n                                tf.expandDims(imageTensor, batchAxis)), [batchAxis]);\n                            }\n                            return imageTensor;\n                        });\n                        prevFaceRectsFromLandmarks = this.prevFaceRectsFromLandmarks;\n                        if (!(config.staticImageMode || prevFaceRectsFromLandmarks == null ||\n                            prevFaceRectsFromLandmarks.length < this.maxFaces)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.detector.detectFaces(image3d, false)];\n                    case 1:\n                        allFaceDetections = _a.sent();\n                        if (allFaceDetections.length === 0) {\n                            this.reset();\n                            image3d.dispose();\n                            return [2 /*return*/, []];\n                        }\n                        faceDetections = allFaceDetections;\n                        // FaceLandmarkFrontCpu: FaceDetectionFrontDetectionToRoi\n                        // Calculates region of interest based on face detections, so that can be\n                        // used to detect landmarks.\n                        faceRectsFromDetections = faceDetections.map(function (detection) {\n                            return _this.faceDetectionFrontDetectionToRoi(detection, imageSize);\n                        });\n                        return [3 /*break*/, 3];\n                    case 2:\n                        faceRectsFromDetections = [];\n                        _a.label = 3;\n                    case 3:\n                        faceRects = (0, association_norm_rect_1.calculateAssociationNormRect)([faceRectsFromDetections, prevFaceRectsFromLandmarks || []], constants.MIN_SIMILARITY_THRESHOLD);\n                        return [4 /*yield*/, Promise.all(faceRects.map(function (faceRect) { return _this.faceLandmark(faceRect, image3d); }))];\n                    case 4:\n                        faceLandmarks = _a.sent();\n                        faces = [];\n                        this.prevFaceRectsFromLandmarks = [];\n                        for (i = 0; i < faceLandmarks.length; ++i) {\n                            landmarks = faceLandmarks[i];\n                            if (landmarks == null) {\n                                continue;\n                            }\n                            this.prevFaceRectsFromLandmarks.push(this.faceLandmarksToRoi(landmarks, imageSize));\n                            keypoints = (0, normalized_keypoints_to_keypoints_1.normalizedKeypointsToKeypoints)(landmarks, imageSize);\n                            // Add keypoint name.\n                            if (keypoints != null) {\n                                keypoints.forEach(function (keypoint, i) {\n                                    var name = constants_1.MEDIAPIPE_FACE_MESH_KEYPOINTS.get(i);\n                                    if (name != null) {\n                                        keypoint.name = name;\n                                    }\n                                });\n                            }\n                            detection = (0, landmarks_to_detection_1.landmarksToDetection)(keypoints);\n                            faces.push({ keypoints: keypoints, box: detection.locationData.relativeBoundingBox });\n                        }\n                        image3d.dispose();\n                        return [2 /*return*/, faces];\n                }\n            });\n        });\n    };\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.dispose = function () {\n        this.detector.dispose();\n        this.landmarkModel.dispose();\n    };\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.reset = function () {\n        this.detector.reset();\n        this.prevFaceRectsFromLandmarks = null;\n    };\n    // calculates face ROI from face detection.\n    // Subgraph: FaceDetectionFrontDetectionToRoi.\n    // ref:\n    // https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_landmark/face_detection_front_detection_to_roi.pbtxt\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.faceDetectionFrontDetectionToRoi = function (detection, imageSize) {\n        // Converts results of face detection into a rectangle (normalized by\n        // image size) that encloses the face and is rotated such that the line\n        // connecting left eye and right eye is aligned with the X-axis of the\n        // rectangle.\n        // FaceDetectionFrontDetectionToRoi: DetectionsToRectsCalculator.\n        var rawRoi = (0, detection_to_rect_1.calculateDetectionsToRects)(detection, 'boundingbox', 'normRect', imageSize, {\n            rotationVectorStartKeypointIndex: 0,\n            rotationVectorEndKeypointIndex: 1,\n            rotationVectorTargetAngleDegree: 0\n        });\n        // Expands and shifts the rectangle that contains the face so that it's\n        // likely to cover the entire face.\n        // FaceDetectionFrontDetectionToRoi: RectTransformationCalculation.\n        var roi = (0, transform_rect_1.transformNormalizedRect)(rawRoi, imageSize, constants.RECT_TRANSFORMATION_CONFIG);\n        return roi;\n    };\n    // Predict face landmarks.\n    // subgraph: FaceLandmarkCpu\n    // ref:\n    // https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_landmark/face_landmark_cpu.pbtxt\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.faceLandmark = function (roi, image) {\n        return __awaiter(this, void 0, void 0, function () {\n            var inputTensors, outputs, outputTensors, faceFlagTensor, landmarkTensors, facePresenceScore, landmarks, _a, faceLandmarks;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        inputTensors = (0, convert_image_to_tensor_1.convertImageToTensor)(image, constants.LANDMARK_IMAGE_TO_TENSOR_CONFIG, roi).imageTensor;\n                        outputs = ['output_faceflag'].concat(this.withAttention ?\n                            [\n                                'output_mesh_identity', 'output_lips', 'Identity_6:0',\n                                'Identity_1:0', 'Identity_2:0', 'Identity_5:0'\n                            ] :\n                            ['output_mesh']);\n                        outputTensors = this.landmarkModel.execute(inputTensors, outputs);\n                        faceFlagTensor = outputTensors[0], landmarkTensors = outputTensors.slice(1);\n                        return [4 /*yield*/, faceFlagTensor.data()];\n                    case 1:\n                        facePresenceScore = (_b.sent())[0];\n                        // Applies a threshold to the confidence score to determine whether a face\n                        // is present.\n                        if (facePresenceScore < constants.FACE_PRESENCE_SCORE) {\n                            tf.dispose(outputTensors);\n                            tf.dispose(inputTensors);\n                            return [2 /*return*/, null];\n                        }\n                        if (!this.withAttention) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.tensorsToFaceLandmarksWithAttention(landmarkTensors)];\n                    case 2:\n                        _a = _b.sent();\n                        return [3 /*break*/, 5];\n                    case 3: return [4 /*yield*/, this.tensorsToFaceLandmarks(landmarkTensors)];\n                    case 4:\n                        _a = _b.sent();\n                        _b.label = 5;\n                    case 5:\n                        landmarks = _a;\n                        faceLandmarks = (0, calculate_landmark_projection_1.calculateLandmarkProjection)(landmarks, roi);\n                        tf.dispose(outputTensors);\n                        tf.dispose(inputTensors);\n                        return [2 /*return*/, faceLandmarks];\n                }\n            });\n        });\n    };\n    // Transform single tensor into 468 facial landmarks.\n    // subgraph: TensorsToFaceLandmarks\n    // ref:\n    // https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_landmark/tensors_to_face_landmarks.pbtxt\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.tensorsToFaceLandmarks = function (landmarkTensors) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[0], constants.TENSORS_TO_LANDMARKS_MESH_CONFIG)];\n            });\n        });\n    };\n    // Transform model output tensors into 478 facial landmarks with refined\n    // lips, eyes and irises.\n    // subgraph: TensorsToFaceLandmarks\n    // ref:\n    // https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_landmark/tensors_to_face_landmarks_with_attention.pbtxt\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.tensorsToFaceLandmarksWithAttention = function (landmarkTensors) {\n        return __awaiter(this, void 0, void 0, function () {\n            var meshLandmarks, lipsLandmarks, leftEyeLandmarks, rightEyeLandmarks, leftIrisLandmarks, rightIrisLandmarks;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[0], constants.TENSORS_TO_LANDMARKS_MESH_CONFIG)];\n                    case 1:\n                        meshLandmarks = _a.sent();\n                        return [4 /*yield*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[1], constants.TENSORS_TO_LANDMARKS_LIPS_CONFIG)];\n                    case 2:\n                        lipsLandmarks = _a.sent();\n                        return [4 /*yield*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[3], constants.TENSORS_TO_LANDMARKS_EYE_CONFIG)];\n                    case 3:\n                        leftEyeLandmarks = _a.sent();\n                        return [4 /*yield*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[5], constants.TENSORS_TO_LANDMARKS_EYE_CONFIG)];\n                    case 4:\n                        rightEyeLandmarks = _a.sent();\n                        return [4 /*yield*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[4], constants.TENSORS_TO_LANDMARKS_IRIS_CONFIG)];\n                    case 5:\n                        leftIrisLandmarks = _a.sent();\n                        return [4 /*yield*/, (0, tensors_to_landmarks_1.tensorsToLandmarks)(landmarkTensors[2], constants.TENSORS_TO_LANDMARKS_IRIS_CONFIG)];\n                    case 6:\n                        rightIrisLandmarks = _a.sent();\n                        return [2 /*return*/, (0, landmarks_refinement_1.landmarksRefinement)([\n                                meshLandmarks, lipsLandmarks, leftEyeLandmarks, rightEyeLandmarks,\n                                leftIrisLandmarks, rightIrisLandmarks\n                            ], [\n                                constants.LANDMARKS_REFINEMENT_MESH_CONFIG,\n                                constants.LANDMARKS_REFINEMENT_LIPS_CONFIG,\n                                constants.LANDMARKS_REFINEMENT_LEFT_EYE_CONFIG,\n                                constants.LANDMARKS_REFINEMENT_RIGHT_EYE_CONFIG,\n                                constants.LANDMARKS_REFINEMENT_LEFT_IRIS_CONFIG,\n                                constants.LANDMARKS_REFINEMENT_RIGHT_IRIS_CONFIG\n                            ])];\n                }\n            });\n        });\n    };\n    // Calculate face region of interest (ROI) from detections.\n    // subgraph: FaceLandmarkLandmarksToRoi\n    // ref:\n    // https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_landmark/face_landmark_landmarks_to_roi.pbtxt\n    MediaPipeFaceMeshTfjsLandmarksDetector.prototype.faceLandmarksToRoi = function (landmarks, imageSize) {\n        // Converts face landmarks to a detection that tightly encloses all\n        // landmarks.\n        // FaceLandmarkLandmarksToRoi: LandmarksToDetectionCalculator.\n        var faceDetection = (0, landmarks_to_detection_1.landmarksToDetection)(landmarks);\n        // Converts the face detection into a rectangle (normalized by image size)\n        // that encloses the face and is rotated such that the line connecting\n        // left side of the left eye and right side of the right eye is aligned\n        // with the X-axis of the rectangle.\n        // FaceLandmarkLandmarksToRoi: DetectionsToRectsCalculator\n        var faceRectFromLandmarks = (0, detection_to_rect_1.calculateDetectionsToRects)(faceDetection, 'boundingbox', 'normRect', imageSize, {\n            rotationVectorStartKeypointIndex: 33,\n            rotationVectorEndKeypointIndex: 263,\n            rotationVectorTargetAngleDegree: 0\n        });\n        // Expands the face rectangle so that in the next video image it's likely\n        // to still contain the face even with some motion.\n        // FaceLandmarkLandmarksToRoi: RectTransformationCalculator.\n        // TODO: `squareLong` in the config should be set to false in MediaPipe code\n        // but is not due to a bug in their processing. Once fixed on their end,\n        // split RECT_TRANSFORMATION_CONFIG into separate detector and landmark\n        // configs, with landmark's config's `squareLong` set to false.\n        var roi = (0, transform_rect_1.transformNormalizedRect)(faceRectFromLandmarks, imageSize, constants.RECT_TRANSFORMATION_CONFIG);\n        return roi;\n    };\n    return MediaPipeFaceMeshTfjsLandmarksDetector;\n}());\n/**\n * Loads the MediaPipeFaceMesh model.\n *\n * @param modelConfig ModelConfig object that contains parameters for\n * the MediaPipeFaceMesh loading process. Please find more details of each\n * parameters in the documentation of the `MediaPipeFaceMeshTfjsModelConfig`\n * interface.\n */\nfunction load(modelConfig) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, landmarkFromTFHub, landmarkModel, detector;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, detector_utils_1.validateModelConfig)(modelConfig);\n                    landmarkFromTFHub = typeof config.landmarkModelUrl === 'string' &&\n                        (config.landmarkModelUrl.indexOf('https://tfhub.dev') > -1);\n                    return [4 /*yield*/, tfconv.loadGraphModel(config.landmarkModelUrl, { fromTFHub: landmarkFromTFHub })];\n                case 1:\n                    landmarkModel = _a.sent();\n                    return [4 /*yield*/, (0, face_detection_1.createDetector)(face_detection_1.SupportedModels.MediaPipeFaceDetector, {\n                            modelType: 'short',\n                            maxFaces: config.maxFaces,\n                            detectorModelUrl: config.detectorModelUrl,\n                            runtime: config.runtime\n                        })];\n                case 2:\n                    detector = _a.sent();\n                    return [2 /*return*/, new MediaPipeFaceMeshTfjsLandmarksDetector(detector, landmarkModel, config.maxFaces, config.refineLandmarks)];\n            }\n        });\n    });\n}\nexports.load = load;\n"},"sourceMaps":{"js":{"version":3,"file":"detector.js","sourceRoot":"","sources":["../../src/tfjs/detector.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"a8ab9d238d323c6c6f6ace0ef732ab35","cacheData":{"env":{}}}