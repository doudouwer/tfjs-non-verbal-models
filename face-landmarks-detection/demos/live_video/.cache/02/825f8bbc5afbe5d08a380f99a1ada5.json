{"id":"node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/landmarks_refinement.js","dependencies":[{"name":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/node_modules/@tensorflow-models/face-landmarks-detection/shared/calculators/landmarks_refinement.js.map","includedInParent":true,"mtime":1758037808369},{"name":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/package.json","includedInParent":true,"mtime":1758036617787},{"name":"/Users/zhangyanjie/Desktop/25Fall/QEF/tfjs-models/face-landmarks-detection/demos/live_video/.babelrc","includedInParent":true,"mtime":1758036617787}],"generated":{"js":"\"use strict\";\n/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.landmarksRefinement = void 0;\nfunction getNumberOfRefinedLandmarks(refinements) {\n    // Gather all used indexes.\n    var indices = [].concat.apply([], refinements.map(function (refinement) { return refinement.indexesMapping; }));\n    if (indices.length === 0) {\n        throw new Error('There should be at least one landmark in indexes mapping');\n    }\n    var minIndex = indices[0], maxIndex = indices[0];\n    var uniqueIndices = new Set(indices);\n    uniqueIndices.forEach(function (index) {\n        minIndex = Math.min(minIndex, index);\n        maxIndex = Math.max(maxIndex, index);\n    });\n    // Check that indxes start with 0 and there is no gaps between min and max\n    // indexes.\n    var numIndices = uniqueIndices.size;\n    if (minIndex !== 0) {\n        throw new Error(\"Indexes are expected to start with 0 instead of \" + minIndex);\n    }\n    if (maxIndex + 1 !== numIndices) {\n        throw new Error(\"Indexes should have no gaps but \" + (maxIndex - numIndices + 1) + \" indexes are missing\");\n    }\n    return numIndices;\n}\nfunction refineXY(indexesMapping, landmarks, refinedLandmarks) {\n    for (var i = 0; i < landmarks.length; ++i) {\n        var landmark = landmarks[i];\n        var refinedLandmark = refinedLandmarks[indexesMapping[i]];\n        refinedLandmark.x = landmark.x;\n        refinedLandmark.y = landmark.y;\n    }\n}\nfunction getZAverage(landmarks, indexes) {\n    var zSum = 0;\n    for (var i = 0; i < indexes.length; ++i) {\n        zSum += landmarks[indexes[i]].z;\n    }\n    return zSum / indexes.length;\n}\nfunction refineZ(indexesMapping, zRefinement, landmarks, refinedLandmarks) {\n    if (typeof zRefinement === 'string') {\n        switch (zRefinement) {\n            case 'copy': {\n                for (var i = 0; i < landmarks.length; ++i) {\n                    refinedLandmarks[indexesMapping[i]].z = landmarks[i].z;\n                }\n                break;\n            }\n            case 'none':\n            default: {\n                // Do nothing and keep Z that is already in refined landmarks.\n                break;\n            }\n        }\n    }\n    else {\n        var zAverage = getZAverage(refinedLandmarks, zRefinement);\n        for (var i = 0; i < indexesMapping.length; ++i) {\n            refinedLandmarks[indexesMapping[i]].z = zAverage;\n        }\n    }\n}\n/**\n * Refine one set of landmarks with another.\n *\n * @param allLandmarks List of landmarks to use for refinement. They will be\n *     applied to the output in the provided order. Each list should be non\n *     empty and contain the same amount of landmarks as indexes in mapping.\n * @param refinements Refinement instructions for input landmarks.\n *\n * @returns A list of refined landmarks.\n */\n// ref:\n// https://github.com/google/mediapipe/blob/master/mediapipe/calculators/util/landmarks_refinement_calculator.cc\nfunction landmarksRefinement(allLandmarks, refinements) {\n    // Initialize refined landmarks list.\n    var numRefinedLandmarks = getNumberOfRefinedLandmarks(refinements);\n    var refinedLandmarks = new Array(numRefinedLandmarks).fill(null).map(Object);\n    // Apply input landmarks to output refined landmarks in provided order.\n    for (var i = 0; i < allLandmarks.length; ++i) {\n        var landmarks = allLandmarks[i];\n        var refinement = refinements[i];\n        if (landmarks.length !== refinement.indexesMapping.length) {\n            // Check number of landmarks in mapping and stream are the same.\n            throw new Error(\"There are \" + landmarks.length + \" refinement landmarks while mapping has \" + refinement.indexesMapping.length);\n        }\n        // Refine X and Y.\n        refineXY(refinement.indexesMapping, landmarks, refinedLandmarks);\n        // Refine Z.\n        refineZ(refinement.indexesMapping, refinement.zRefinement, landmarks, refinedLandmarks);\n        // Visibility and presence are not currently refined and are left as `0`.\n    }\n    return refinedLandmarks;\n}\nexports.landmarksRefinement = landmarksRefinement;\n"},"sourceMaps":{"js":{"version":3,"file":"landmarks_refinement.js","sourceRoot":"","sources":["../../../src/shared/calculators/landmarks_refinement.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"b6426aa3501e7c42d8830b9e60fd66ba","cacheData":{"env":{}}}